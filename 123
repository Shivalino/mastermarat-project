# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd "C:\Projects\mastermaratcom\mastermarat-project"

# –°–æ–∑–¥–∞–µ–º MD —Ñ–∞–π–ª —Å –¥–∞—Ç–æ–π
$date = Get-Date -Format "yyyy-MM-dd"
$outputFile = "2025-07-01_[CODE]_Modular-Architecture.md"

# –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
@"
# –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MasterMarat API
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: $date
**–°—Ç–∞—Ç—É—Å**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
workers/api/src/
‚îú‚îÄ‚îÄ worker-new.js              # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä (30 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ courses.js            # –î–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤ –∏ —É—Ä–æ–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ constants.js          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Ç–æ–∫–µ–Ω—ã
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ api.js               # GET / - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ thumbnails.js        # GET /thumbnails/*
‚îÇ   ‚îú‚îÄ‚îÄ video.js             # GET /video/*
‚îÇ   ‚îú‚îÄ‚îÄ player-learning.js   # GET /player/* (–æ–±—É—á–µ–Ω–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ player-archive.js    # GET /archive/* (–∞—Ä—Ö–∏–≤)
‚îÇ   ‚îú‚îÄ‚îÄ webhooks.js          # POST /webhook/*
‚îÇ   ‚îî‚îÄ‚îÄ test.js              # GET /test (—Ç–æ–∫–µ–Ω—ã)
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ cors.js              # CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ errors.js            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ token.js             # –†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏
‚îî‚îÄ‚îÄ services/                 # –°–µ—Ä–≤–∏—Å—ã (—Å–æ–∑–¥–∞–Ω—ã)
‚îú‚îÄ‚îÄ auth.js              # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ sendpulse.js         # SendPulse API
‚îî‚îÄ‚îÄ content.js           # –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

## üìÑ –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥

"@ | Out-File -FilePath $outputFile -Encoding UTF8

Write-Host "üìù –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã..." -ForegroundColor Cyan

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≤ MD
function Add-FileToMarkdown {
    param(
        [string]$FilePath,
        [string]$Title
    )
    
    if (Test-Path $FilePath) {
        $content = Get-Content $FilePath -Raw
        $relativePath = $FilePath.Replace("$PWD\", "").Replace("\", "/")
        
        Add-Content $outputFile -Value @"

### $Title
**–§–∞–π–ª**: ``$relativePath``

``````javascript
$content
"@
Write-Host "  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: $Title" -ForegroundColor Gray
} else {
Write-Host "  ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω: $FilePath" -ForegroundColor Red
}
}
–î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
Write-Host "`nüìÇ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:" -ForegroundColor Yellow
Add-FileToMarkdown "workers\api\wrangler.toml" "wrangler.toml - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Cloudflare"
Add-FileToMarkdown "workers\api\package.json" "package.json - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞"
Write-Host "`nüöÄ –û—Å–Ω–æ–≤–Ω–æ–π –≤–æ—Ä–∫–µ—Ä:" -ForegroundColor Yellow
Add-FileToMarkdown "workers\api\src\worker-new.js" "worker-new.js - –ú–æ–¥—É–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä"
Write-Host "`n‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:" -ForegroundColor Yellow
Add-FileToMarkdown "workers\api\src\config\courses.js" "courses.js - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É—Ä—Å–æ–≤"
Add-FileToMarkdown "workers\api\src\config\constants.js" "constants.js - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Ç–æ–∫–µ–Ω—ã"
Write-Host "`nüì° –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (handlers):" -ForegroundColor Yellow
Add-FileToMarkdown "workers\api\src\handlers\api.js" "api.js - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API"
Add-FileToMarkdown "workers\api\src\handlers\thumbnails.js" "thumbnails.js - –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"
Add-FileToMarkdown "workers\api\src\handlers\video.js" "video.js - –°—Ç—Ä–∏–º–∏–Ω–≥ –≤–∏–¥–µ–æ"
Add-FileToMarkdown "workers\api\src\handlers\player-learning.js" "player-learning.js - –ü–ª–µ–µ—Ä –æ–±—É—á–µ–Ω–∏—è"
Add-FileToMarkdown "workers\api\src\handlers\player-archive.js" "player-archive.js - –ê—Ä—Ö–∏–≤–Ω—ã–π –ø–ª–µ–µ—Ä"
Add-FileToMarkdown "workers\api\src\handlers\webhooks.js" "webhooks.js - –í–µ–±—Ö—É–∫–∏ SendPulse"
Add-FileToMarkdown "workers\api\src\handlers\test.js" "test.js - –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"
Write-Host "`nüõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã:" -ForegroundColor Yellow
Add-FileToMarkdown "workers\api\src\utils\cors.js" "cors.js - CORS —Ñ—É–Ω–∫—Ü–∏–∏"
Add-FileToMarkdown "workers\api\src\utils\errors.js" "errors.js - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"
Add-FileToMarkdown "workers\api\src\utils\token.js" "token.js - –†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏"
Write-Host "`nüíº –°–µ—Ä–≤–∏—Å—ã:" -ForegroundColor Yellow
Add-FileToMarkdown "workers\api\src\services\auth.js" "auth.js - –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"
Add-FileToMarkdown "workers\api\src\services\sendpulse.js" "sendpulse.js - SendPulse –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è"
Add-FileToMarkdown "workers\api\src\services\content.js" "content.js - –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º"
–î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
Add-Content $outputFile -Value @"
üîê –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã
–¢–æ–∫–µ–Ω–¢–∏–ø–î–æ—Å—Ç—É–øsuperuser_mastermarat_2025SuperUser–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—Évip_test_token_2025VIP–ù–µ—Å–∫–æ–ª—å–∫–æ –∫—É—Ä—Å–æ–≤ + –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏standard_test_token_2025Standard–ö—É—Ä—Å + –∞—Ä—Ö–∏–≤basic_test_token_2025Basic–¢–æ–ª—å–∫–æ –ø–ª–µ–µ—Ädemo123Demo–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã
bash# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev                    # localhost:8787

# –î–µ–ø–ª–æ–π
npm run deploy:dev            # api-dev.mastermarat.com
npm run deploy                # api.mastermarat.com

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm run test
npm run lint
üìù –ü—Ä–∏–º–µ—Ä—ã URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8787/
–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: http://localhost:8787/test
–ü–ª–µ–µ—Ä –æ–±—É—á–µ–Ω–∏—è: http://localhost:8787/player/course1/week1_lesson1?token=superuser_mastermarat_2025
–ê—Ä—Ö–∏–≤ –∫—É—Ä—Å–∞: http://localhost:8787/archive/course1?token=superuser_mastermarat_2025
–í–∏–¥–µ–æ –Ω–∞–ø—Ä—è–º—É—é: http://localhost:8787/video/course1/test_video.mp4?token=superuser_mastermarat_2025

‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - —Ä–∞–∑–±–∏–ª–∏ –º–æ–Ω–æ–ª–∏—Ç –Ω–∞ –º–æ–¥—É–ª–∏
–î–≤–∞ —Ç–∏–ø–∞ –ø–ª–µ–µ—Ä–∞ - learning (–∏–∑ email) –∏ archive (—Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π)
–°–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ - —Ä–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω - —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –≤ —Å—Ç–∏–ª–µ MasterMarat
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç - –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–¥ –≤–∏–¥–µ–æ

üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ R2
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å SendPulse –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
–ó–∞–º–µ–Ω–∏—Ç—å worker.js –Ω–∞ worker-new.js –≤ production
–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤


–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ $(Get-Date -Format "dd.MM.yyyy HH:mm")
"@
–ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
$fileCount = (Get-Content $outputFile | Select-String -Pattern "^### " -AllMatches).Matches.Count
$totalSize = [math]::Round((Get-Item $outputFile).Length / 1KB, 2)
Write-Host "n‚úÖ –ì–æ—Ç–æ–≤–æ!" -ForegroundColor Green Write-Host "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:" -ForegroundColor Cyan Write-Host "  ‚Ä¢ –§–∞–π–ª–æ–≤ —Å–æ–±—Ä–∞–Ω–æ: $fileCount" -ForegroundColor White Write-Host "  ‚Ä¢ –†–∞–∑–º–µ—Ä MD —Ñ–∞–π–ª–∞: $totalSize KB" -ForegroundColor White Write-Host "  ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤: $outputFile" -ForegroundColor White Write-Host "nüí° –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞!" -ForegroundColor Yellow
–û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–ø–∫—É —Å —Ñ–∞–π–ª–æ–º
Start-Process explorer.exe -ArgumentList $PWD.Path

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- üìù –°–æ–±–µ—Ä–µ—Ç –≤–µ—Å—å –∫–æ–¥ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤ –æ–¥–∏–Ω MD —Ñ–∞–π–ª
- üìÅ –°–æ—Ö—Ä–∞–Ω–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- üìä –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- üóÇÔ∏è –û—Ç–∫—Ä–æ–µ—Ç –ø–∞–ø–∫—É —Å –≥–æ—Ç–æ–≤—ã–º —Ñ–∞–π–ª–æ–º

–ó–∞–ø—É—Å–∫–∞–π —Å–∫—Ä–∏–ø—Ç, –∏ —É —Ç–µ–±—è –±—É–¥–µ—Ç –ø–æ–ª–Ω—ã–π –¥–∞–º–ø –≤—Å–µ–≥–æ –∫–æ–¥–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã! üöÄ

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
workers/api/src/
‚îú‚îÄ‚îÄ worker-new.js              # –û—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä (30 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ courses.js            # –î–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ–≤ –∏ —É—Ä–æ–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ constants.js          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Ç–æ–∫–µ–Ω—ã
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ api.js               # GET / - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ thumbnails.js        # GET /thumbnails/*
‚îÇ   ‚îú‚îÄ‚îÄ video.js             # GET /video/*
‚îÇ   ‚îú‚îÄ‚îÄ player-learning.js   # GET /player/* (–æ–±—É—á–µ–Ω–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ player-archive.js    # GET /archive/* (–∞—Ä—Ö–∏–≤)
‚îÇ   ‚îú‚îÄ‚îÄ webhooks.js          # POST /webhook/*
‚îÇ   ‚îî‚îÄ‚îÄ test.js              # GET /test (—Ç–æ–∫–µ–Ω—ã)
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ cors.js              # CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ errors.js            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ token.js             # –†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏
‚îî‚îÄ‚îÄ services/                 # –°–µ—Ä–≤–∏—Å—ã (—Å–æ–∑–¥–∞–Ω—ã)
‚îú‚îÄ‚îÄ auth.js              # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ sendpulse.js         # SendPulse API
‚îî‚îÄ‚îÄ content.js           # –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º